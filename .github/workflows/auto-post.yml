name: 🤖 Auto Post Bot

on:
  # Schedulazione automatica
  schedule:
    - cron: '0 9 * * *'   # 9 AM UTC = 10/11 AM Italia (estate/inverno)
    - cron: '0 17 * * *'  # 5 PM UTC = 6/7 PM Italia
  
  # Permetti esecuzione manuale
  workflow_dispatch:

jobs:
  auto-post:
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v4
      
      - name: 🐍 Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: 📦 Install dependencies
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: 🤖 Generate and post content
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          BLUESKY_USERNAME: ${{ secrets.BLUESKY_USERNAME }}
          BLUESKY_PASSWORD: ${{ secrets.BLUESKY_PASSWORD }}
        run: |
          python -m src.main --auto
      
      - name: 📊 Upload logs (if any)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: bot-logs-${{ github.run_number }}
          path: |
            *.log
            data/*.db
          retention-days: 7
